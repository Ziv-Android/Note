# 反思个人面试过程中遇到的不足和常见问题
### HR
问答环节
1. 问：14年毕业，为什么从15年才开始工作？
答：毕业后准备考研，考研目标是 四川电子科技大学 ，最终虽然没有考上，但在复习考研的过程中得到了很多收获，如高效的学习方法，如何应对长时间持续高压等
本次失误：
目标城市和院校过于分散
回答过于简单，没有突出收获

2. 问：从第一家北京的乐视离职的原因？
答：进入了外包公司，工作了一段时间没有归属感，从而选择离开。
追问：为什么没有从外包转正式？
答：回答为后来到深圳做铺垫。如环境因素，薪资待遇外兴趣，如对人工智能感兴趣

3. 问：为什么从商汤离职？
答：面试入职后从事的职业更偏向于嵌入式，且后期项目组整体搬迁至上海，因此选择了离开

4. 问：为什么从泰捷离职？
答：期望能在腾讯的平台有更好的发展

5. 问：目标薪酬18～20k，涨幅翻倍？
答：薪资构成  
薪酬12000+3000绩效，涨幅30%，目标20K，涨幅20%的话，保守目标18K，最后再次表示十分想去咱们平台长期稳定发展

### 技术
介绍最近项目经历
我在深圳泰捷公司主要做了泰捷视频的项目以及后续的新闻短视频项目的开发，主要是面向用户提供影片播放功能，在这个项目中，我参与了视频播放功能和统计模块的开发，优化和维护，这里用到了MediaPlayer + SurfaceView实现播放和ASM插桩等技术。该项目目前日活约40万等。

简述开发应用的流程：
1. 开发前与项目经理沟通理清业务需求，确定要做什么。如果有不合理的地方及时提出，共同改进
2. 开发时，应用的是否存在卡顿情况和对内存的消耗存在异常，将问题暴漏在开发阶段并参考自己过往的经验进行问题的解决和规避
3. 开发完成后优先自己测试一下，在不影响进度的前提下，尽可能提交执行效率更高，内存占用更小的代码
4. 项目过程中如果遇到棘手问题：首先查阅资料，实在没有解决思路及时与技术leader等相关人员沟通，寻找解决办法，问题解决后进行分析总结。

具体到介绍一个自己做的项目的想法，即开发中的想法时，参考如下回答
1. 参考Google的Jetpack推荐的设计并参考MVVM的模式，设计显示页面与数据管理分离的项目结构
2. 除非有明确说明，设计数据的本地持久性数据模型（内存，文件，数据库）和远程后端数据模型，并创建管理类进行数据管理，显示页面的数据源只能是该数据管理类，即做到 单一可信来源
3. 页面实现尽可能考虑适配和解耦，数据传递可以采用EventBus或LiveData（LiveData 组件遵循应用组件的生命周期状态，包括清理逻辑以防止对象泄漏和过多的内存消耗。）

EventBus原理
单利模式，创建者模式，观察者模式
register通过反射遍历注册对象的方法，获取其中带有@Subscribe标签的方法并且放在一个列表中，最后以注册对象为key，@Subscribe的方法列表作为value放在HashMap中。
一个Event可能会有被多个subsribe订阅，所以有当执行post(Event)的时候会查找到所有订阅了Event事件的subscribe并调用其中的event方法。执行postSticky的时候会将event.getclass和event保存起来。
ThreadMode.PostThread：发送事件的线程执行接收事件
ThreadMode.MainThread：UI线程执行
ThreadMode.BackgroundThread：子线程队列中依次执行
ThreadMode.Async：每个事件均开辟新的子线程执行处理
EventBus缺点
1、使用的时候有定义很多event类，
2、event在注册的时候会调用反射去遍历注册对象的方法在其中找出带有@subscriber标签的方法，性能不高。
3、需要自己注册和反注册，如果忘了反注册就会导致内存泄漏

fresco/Glide


okHttp/retrofit  
OKHTTP(Socket 连接池、Http缓存、责任链)、Retrofit(动态代理)  

tcp
三次握手，四次挥手
udp

MediaPlayer
状态机 + 创建本地代理，Socket

帧率：FPS每秒多少帧画面，流畅度
码率：每秒显示的图片压缩后的数据量，文件体积
分辨率：图片尺寸，视图大小

好的画质是分辨率、帧率和码率三者之间的平衡：
码率不是越大越好，码率大意味着巨额流量支出
帧率不要超过24，帧率越高，编码器就必须加大对单帧画面的压缩比，即降低画质
分辨率不盲目攀高，分辨率越高就会让编码器越 “为难" 


SurfaceView  
Surface，一个包含Canvas的原始图像缓冲区的句柄，管理显示内容的数据，实现了

进程间通信
1. Android
    - AIDL：只有允许不同应用的客户端用 IPC 方式调用远程方法，并且想要在服务中处理多线程时，才有必要使用 AIDL
    - Binder：如果需要调用远程方法，但不需要处理并发 IPC，就应该通过实现一个 Binder 创建接口，使用简单高效，更安全，可对进程UID/PID进行身份鉴别
    - Messenger：如果您想执行 IPC，但只是传递数据，不涉及方法调用，也不需要高并发，就使用 Messenger 来实现接口
    - ContentProvider：如果需要处理一对多的进程间数据共享（主要是数据的 CRUD），就使用 ContentProvider
    - Socket：如果要实现一对多的并发实时通信，就使用 Socket 网络数据获取
    - 文件：没有并发的简单交换数据场景
2. Linux
    - 管道：数据先进先出，不支持通信效率低，不适合频繁交换数据
    - 消息队列：保存在内核中的消息链表，限制数据大小，存在用户态与内核态之间的数据拷贝开销
    - 共享内存：多个进程修改冲突
    - 信号量：信号量其实是一个整型的计数器，主要用于实现进程间的互斥与同步，而不是用于缓存进程间通信的数据。PV操作
    - 信号：异常情况下的工作模式，`kill -l` 命令，查看所有的信号，常见的有SIGKILL，SIGINT，是唯一的异步通信机制，进程有三种方式响应信号 1. 执行默认操作、2. 捕捉信号、3. 忽略信号
    - Socket

进程和线程的区别？
进程间相互独立。进程正在执行的应用程序，是软件的执行副本，是CPU**分配资源的基础单位**，线程作为轻量级进程，是**程序执行的基本单位**。创建进程一定会创建主线程，进程创建需要分配内存空间并初始化，线程仅需要确定程序计数器PC指针，寄存器的值和执行程序的栈即可，同一个进程的多个线程之间可以复用堆栈

创建、就绪、运行、阻塞(等待)、退出

线程调度相关
非抢占的先到先服务，可以保证公平性和吞吐量，但操作系统希望减少用户等待平均时间，就一定会实现抢占，为了解决长任务始终抢占，而引入了短任务优先的策略。即整体采用分级队列，最高优先级的任务采用非抢占，保证最优先执行，其他任务按高优先级执行时间短向低优先级执行时间长逐级沉降，实现小任务和高优先任务优先执行，减少用户的等待平均时间。

协程，英文Coroutines，是一种基于线程之上，但又比线程更加轻量级的存在，这种由程序员自己写程序来管理的轻量级线程叫做『用户空间线程』，具有对内核来说不可见的特性。

插件化框架
Shadow（Tencnet）自定义Transform替换其父类为ShadowActivity

CountDownLatch

Android中的类加载机制
加载、连接、初始化。其中连接分为三个步骤：验证、准备、解析

java的Object类有哪些方法
toString
hashCode
getclass
wait
notify
equals
clone
finalize

Lambda表达式和匿名内部类的区别
所需类型不同：
匿名内部类：可以是抽象类，可以是接口，也可以是具体类
Lambda表达式：只可以是接口
使用限制不同：
如果接口中有且仅有一个抽象方法，可以使用Lambda表达式，也可以使用匿名内部类
如果接口中的抽象方法不止一个，就只能使用匿名内部类，不能使用Lambda表达式
实现原理不同：
匿名内部类在编译之后会产生一个单独的.class字节码文件
Lambda表达式在编译之后不会产生一个单独的.class字节码文件，对应的字节码会在运行的时候动态生成

范型 -> 范型擦除：  
优点：兼容性好，运行时内存负担小  
缺点：
1. 基本类型无法作为范型实参，装箱/拆箱
2. 范型类型不能作为真实类型使用

可通过反射getGenericReturnType获取真实类型
Gson的TypeToken和Retrofit中返回值用来获取范型返回类型
混淆kotlin.Metadata保留签名信息，用于反射

设计App
1. 明确需求边界
2. 打通关键流程
3. 播放器可移植，滤镜脚本化，安全性


## 优化
### 卡顿
使用dumpsys cpuinfo / top 等工具检查 CPU ：load average和IO，排除CPU忙导致的卡顿
使用Handler Loop.loop() Looper.getMainLooper().setMessageLogging(new Printer(){})创建工作线程监控UI线程的卡顿
#### 布局优化
1. 静态Lint代码检查
2. systrace
python $ANDROID_HOME/platform-tools/systrace/systrace.py --time=20 -o ~/trace.html gfx view res
ConstraintLayout
3. 过度渲染
在页面onPause生命周期内，反射系统反射系统过度渲染计数的类，输出过度渲染计数。getHardWareRenderer 和 HardwareRenderer.java代码中debugOverdraw

#### 内存优化  
内存溢出 - Bitmap大图/列表  
1. 利用了Options类里的参数设置Bitmap.Config.RGB_565低色彩的解析模式;
2. 资源文件合理放置，高分辨率图片可以放到高分辨率目录下
3. inSampleSize，采样图片 生成缩略图
4. BitmapRegionDecoder图片分块加载

内存泄漏  
1. Android profile + Dump Java Heap  
2. LeakCanary


内存抖动  
避免在循环体内频繁分配和回收
String 加号拼接，替换为format或StringBuilder实现
发布阶段关闭大量无用的开发日志打印

#### 算法



#### 其他基础



1. 不露痕迹的说面试官爱听的话
2. 能考虑到拓展性，有参与框架设计的意识
3. 有调优意识，能主动发现问题，并解决
4. 动手能力强，肯干活，会的东西多，有团队合作精神
5. 责任心较强，能使用较大压力
6. 避免犯低级错误，低级错误拥有一票否决权
7. 主动亮出自己的加分项，但不要说太全，如果面试官没有往下接，说明这个对方不care，说下去也没意义，反而让人觉得你是有备而来


adb shell dumpsys gfxinfo app的包名 >FPS.txt  


英语自我介绍  
My English speek is not very good, So I prepared some tips for me. I’m very happy and excited for having a face to face interview in your company. Firstly, please allow me to introduce myself: My name is Zhao Peng, I graduated from Inner Mongolia Normal University in 2014 and I majored in Computer Science Technology. To be honest, I’m interested in software programming.
Secondly, I have worked in TogicVideo company for four years. During these passing days, I learned a lot in it. I’m skilled in some kinds of computer languages, such as Java/Python/C. I have good experiences in developing software using technologies like media playback and app-optimization.
Thirdly, In my daily life, I’m fond of reading, writing blogs. I’m a man who is full of passionate, careful and strong teamwork spirit. I think I’m very suitable for this job and hope you can give me a chance for being a member of your company.
That’s all. Thank you!