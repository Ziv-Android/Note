# 测试工具

## 背景

- 到2021年9月中旬，研发修改bug和增加需求自测时还用网页和工具点一点完成自验，缺乏系统性保证（改出bug）。
- 要能做到系统性验证并且不增加MDE的工作，那需要设计一套比较好的方案去改善当前问题：开发自测，整机测试，冒烟测试，协议说明存档。
- 很多不同类产品功能有相同的，但设计的协议各不相同，这非常不利于公司长久发展。没有集中管理协议，各产品增加功能时设计没有参考。


## 目标

1. 用于记录功能协议；设计、添加新功能后，按照`一定`格式书写测试用例，既能完成协议测试，又能一键把协议转换输出成文档；
2. 自动化测试用例尽全力设计到全覆盖，不能覆盖测试用例功能文件中描述清楚；
    1. 用这些自动化测试避免以后功能，增加、修改模块避免引入bug；
    2. 用这些自动化测试避免模块重构时功能缺失，功能被修改；

- **PS:需设计导出测试用例成协议文件方案。更新测试用例后，更改协议文件；仅需维护一份文件既能用作测试用例，又能搞定协议文档岂不快哉。**

  

## 设计

### 目录结构

- 框架中通用目录包括：request（请求类测试：http，tcp），push（推送类测试：http推送），terminal（终端控制：telnet，ssh）

- 测试用例按功能模块写测试用例在主目录中的不同文件，取名参考如下：
    1. 通用->云台：c_ptz.py
    2. 通用->电动镜头：c_lens.py
    3. H产品->HTTP推送：h_httppush.py 继承至 push/httppush.py
    
    功能测试文件前用`c`开头，此为通用功能测试文件；功能测试文件用产品类型开头，此为产品特有测试用例。
    
    

### 推送（push）协议测试






### 请求（request）测试设计

- 无论系统还是业务模块都会提供两类消息。
    1. 系统内部使用，通过DP交互；
    2. 系统对外使用，通过HTTP或TCP与模块通信交互;
- 完成模块功能测试，规定凡能用HTTP、TCP测试的功能就不用DP测试。

- 为保证测试用例书写简便，先规划使用统一的接口完成测试。测试接口类：
  
    1. WEBClient：Web服务客户端，用于测试用户界面的的消息；
    ```
    from request.webclient import WEBClient
    
    url = 'http://192.168.17.203:80'            # 测试设备web地址
    username = 'admin'                          # 用户名
    password = 'admin'                          # 密码
    
    wc = WEBClient(url, username, password)     # 创建web连接
    
    cmd = '{"module":"BUS_WEB_REQUEST","type":"get_device_info"}‘
    status, resp = wc.posts(cmd)                # post请求
    print(status)
    print(resp)
    ```

    2. TCPClient：TCP服务客户端，用户测试VZSDK、TCPSDK对接消息；
    ```
    
    ```

